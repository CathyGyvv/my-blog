 http走服务器的80端口，
 
 
 https走443端口，那么，80端口没用了吗，当然有用，可以传输数据。443端口，只是建立连接的时候，处理协商数据。443端口，改了就不能用了，浏览器处理https协议，直接走443端口，浏览器提交支持的加密算法列表，服务器收到请求，下发一个加密算法，和自己支持的加密算法进行比对，如果不符合，则断开连接。否则，服务端会把符合的算法和证书发给客户端，包括证书时间、证书日期、证书颁发的机构，公钥,然后80端口去拿数据返回。
 
 数字证书有两个作用：一个是通过数字证书向浏览器证明服务器的身份，另一个是数字证书里面包含了服务器公钥。

 客户端验证证书，包括颁发证书的机构是否合法与是否过期，证书中包含的网站地址是否与正在访问的地址一致。保存公钥，客户端会生成一个随机字符串，然后用服务端的公钥进行加密，这里就保证了只有服务端才能看到这串随机字符串，并向服务器发送加密后的数据；最后服务器拿出自己的私钥，解密出数据，并返回确认消息。  

将 HTTP 数据提交给 TCP 层之后，数据会经过用户电脑、WiFi 路由器、运营商和目标服务器，在这中间的每个环节中，数据都有可能被窃取或篡改

### 为什么要有HTTPS
- http明文传输，不安全  
- 不验证通信方的身份，无法保证消息来源的可靠性。  
- 无法验证报文的完整性和准确性。  


HTTP+加密+认证 == HTTPS  
 
HTTPS在传输数据之前需要客户端与服务器进行一个握手(TLS/SSL握手)，在握手过程中将确立双方加密传输数据的密码信息。主要通过数字证书、加密算法、非对称密钥等技术完成互联网数据传输加密

HTTPS相比于HTTP，虽然提供了安全保证，但是势必会带来一些时间上的损耗，如握手和加密等过程，是否使用HTTPS需要根据具体情况在安全和性能方面做出权衡。


## 怎么理解HTTPS协议工作流程？ 

客户端发出 https 请求，请求服务端建立 SSL 连接。
服务端收到 https 请求，申请或自制数字证书，得到公钥和服务端私钥，并将公钥发送给客户端验证公钥，不通过验证则发出警告，通过验证则产生一个随机的客户端私钥。
客户端将公钥与客户端私钥进行对称加密后传给服务端。
服务端收到加密内容后，通过服务端私钥进行非对称解密，得到客户端私钥。
服务端将客户端私钥和内容进行对称加密，并将加密内容发送给客户端。
客户端收到加密内容后，通过客户端私钥进行对称解密，得到内容。


## TLS/SSL协议怎么保障信息安全
PKI证书 

密钥交换协议（https在TCP握手的时候约定使用哪种密钥交换的协议来传递我们使用的密钥） 

对称加密算法


http（没有经过加密） 数据链路层==》 IP ==》   TCP层 ==》 HTTP

https(经过加密的)   数据链路层 ==》 IP ==》 TCP层   ==》 SSL/TLS安全层  ==》 HTTP

安全层有两个主要的职责：对发起 HTTP 请求的数据进行加密操作和对接收到 HTTP 的内容进行解密操作****

对称加密：即通信的双⽅都使⽤同⼀个秘钥进⾏加解密，⽐如特务接头的暗号，就属于对称加密

⾮对称加密：

私钥 + 公钥= 密钥对
即⽤私钥加密的数据,只有对应的公钥才能解密,⽤公钥加密的数据,只有对应的私钥才能解密
因为通信双⽅的⼿⾥都有⼀套⾃⼰的密钥对,通信之前双⽅会先把⾃⼰的公钥都先发给对⽅
然后对⽅再拿着这个公钥来加密数据响应给对⽅,等到到了对⽅那⾥,对⽅再⽤⾃⼰的私钥进⾏解密
⾮对称加密虽然安全性更⾼，但是带来的问题就是速度很慢，影响性能。 


那么结合两种加密⽅式，将对称加密的密钥使⽤⾮对称加密的公钥进⾏加密，然后发送出去，接收⽅使⽤私钥进⾏解密 得到对称加密的密钥，然后双⽅可以使⽤对称加密来进⾏沟通。

此时⼜带来⼀个问题，中间⼈问题：

如果此时在客户端和服务器之间存在⼀个中间⼈,这个中间⼈只需要把原本双⽅通信互发的公钥,换成⾃⼰的公钥,这样中 间⼈就可以轻松解密通信双⽅所发送的所有数据。

所以这个时候需要⼀个安全的第三⽅颁发证书（CA），证明身份的身份，防⽌被中间⼈攻击。 证书中包括：签发者、证书⽤途、使⽤者公钥、使⽤者私钥、使⽤者的HASH算法、证书到期时间等 


但是问题来了，如果中间⼈篡改了证书，那么身份证明是不是就⽆效了？这个证明就⽩买了，这个时候需要⼀个新的技 术，数字签名。

数字签名就是⽤CA⾃带的HASH算法对证书的内容进⾏HASH得到⼀个摘要，再⽤CA的私钥加密，最终组成数字签 名。

当别⼈把他的证书发过来的时候,我再⽤同样的Hash算法,再次⽣成消息摘要，然后⽤CA的公钥对数字签名解密,得到CA创建的消息摘要,两者⼀⽐,就知道中间有没有被⼈篡改了。

这个时候就能最⼤程度保证通信的安全了。 



如果在客户端生成密钥对，把私钥发给服务端，那么服务端需要为每个客户端保存一个密钥，这显然是不太现实的。所以只能由服务端生成密钥对，将公钥分发给需要建立连接的客户端。

直接发送给客户端还是会被篡改，此时只能借助第三方来实现了，比如证书机制。

具体来说就是把公钥放入一个证书中，该证书包含服务端的信息，比如颁发者、域名、有效期，为了保证证书是可信的，需要由一个可信的第三方来对证书进行签名。这个第三方一般是证书的颁发机构，也称 CA（Certification Authority，认证中心）。

那么这个证书的签名怎么检验真假呢？

要回答这个问题先要理解证书签名的过程。证书签名就是将证书信息进行 MD5 计算，获取唯一的哈希值，然后再利用证书颁发方的私钥对其进行加密生成。

校验过程与之相反，需要用到证书颁发方的公钥对签名进行解密，然后计算证书信息的 MD5 值，将解密后的 MD5 值与计算所得的 MD5 值进行比对，如果两者一致代表签名是可信的。所以要校验签名的真伪，就需要获得证书颁发方的公钥，这个公钥就在颁发方的证书中。

这种通过签名来颁发与校验证书的方式会形成一个可追溯的链，即证书链。处于证书链顶端的证书称为根证书，这些根证书被预置在操作系统的内部。 



Client 发送 random1+对称加密套件列表+非对称加密套件列表  

Server 收到信息， 选择 对称加密套件+非对称加密套件 并和 random2+证书(公钥在证书中) 一起返回  


Client 验证证书有效性，并用 random1+random2 生成 pre-master 通过服务器公钥加密+浏览器确认 发送给 Server  

Server 收到 pre-master，根据约定的加密算法对 random1+random2+pre-master（解密）生成 master-secret，然后发送服务器确认  

Client收到生成同样的 master-secert，对称加密秘钥传输完毕


https在内容传输的加密上使用了对称加密，非对称加密只作用在证书验证阶段。

常规下抓包工具抓到的内容是加密状态，无法查看。但在客户端可以被截取数据。


HTTPS通信先是使用非对称加密进行密钥的协商，协商出一个对称加密的密钥，之后的通信则采用这个对称密钥进行对称加密进行密文传输。因为非对称加密其算法及其复杂，导致解密效率低下，而对称加密效率则明显高出百倍。


HTTPS是安全的。拿物流来比方，
HTTPS 就是你把包裹包装得很安全；
DNS劫持 就是有个人冒充快递来收单子了；

https可以缓存

1. Client发起一个HTTPS请求，连接443端口。这个过程可以理解成是「请求公钥的过程」。  

2. Server端收到请求后，通过第三方机构私钥加密，会把数字证书（也可以认为是公钥证书）发送给Client 

3.在安全拿到「服务器公钥」后，客户端Client随机生成一个「对称密钥」，使用「服务器公钥」（证书的公钥）加密这个「对称密钥」，发送给Server(服务器)。

4.Server(服务器)通过自己的私钥，对信息解密，至此得到了「对称密钥」，此时两者都拥有了相同的「对称密钥」

后面就可以传输信息了。
Client用户使用该「对称密钥」加密'明文内容B',发送给Server(服务器)
Server使用该「对称密钥」进行解密消息，得到明文内容B。